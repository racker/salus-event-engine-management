stream
  |from()
    .measurement('measurement')
    .groupBy('system_resource_id')
  |where(lambda:
    isPresent("resource_metadata_os") AND ("resource_metadata_os" == 'linux')
      )
  |stateDuration(lambda: (("field" > 33) OR ("test" <= 17)) OR ("new_field" =~ "my_value"))
    .unit(1m)
    .as('crit_count')
  |stateDuration(lambda: ("field" > 30))
    .unit(1m)
    .as('warn_count')
  |stateDuration(lambda: ("field" > 20))
    .unit(1m)
    .as('info_count')
  |alert()
    .stateChangesOnly()
    .id('{{ .TaskName }}:{{ .Group }}')
    .details('task={{.TaskName}}')
    .info(lambda: "info_count" >= 1)
    .warn(lambda: "warn_count" >= 3)
    .crit(lambda: "crit_count" >= 5)
    .history(21)
    .topic('events')